!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.AnyLogger=t()}(this,function(){var e={},t={},o=0,s=[],n=function(e,t){return t&&(t.scope&&(e="["+t.scope+"]"+e),t.module&&(e="["+t.module+"]"+e),t.date&&(e="["+t.date.toISOString()+"]"+e)),e},l=function(){return{type:"console",write:"undefined"==typeof console?function(){}:function(e,o){var s;o===t.logLevels.WARN&&console.warn?s=console.warn:o===t.logLevels.ERROR&&console.error?s=console.error:o===t.logLevels.INFO&&console.info?s=console.info:o===t.logLevels.DEBUG&&console.debug&&(s=console.debug),s&&s.call(console,e,{noCollect:!0})}}},r=function(e){this.settings={},this.handlers=[],this.capturedLogs=[],this.id=e.id,this.settings.captureLogsLimit=t.defaultCaptureLogsLimit;var o=this;e.captureLogs&&(e.captureLogsLimit&&this.captureLogsLimit(e.captureLogsLimit),this.flushCapturedLogsOnLimit(e.flushCapturedLogsOnLimit),this.flushCapturedLogsOnError(e.flushCapturedLogsOnError),this.captureLogs(!0)),0!=e.logToConsole&&this.handlers.push(l()),s.forEach(function(t){t.create(o,e)}),e.handlers&&e.handlers.forEach(o.addHandler.bind(o)),e.formatter?this.formatter=e.formatter:0!=e.useFormatter&&(this.formatter=n),e.logLevel?this.logLevel(e.logLevel):this.logLevel(t.defaultLogLevel),e.module&&(this.settings.module=e.module),e.collect&&g.call(this)},i=r.prototype;i.logLevel=function(e){return"string"==typeof e&&e.toUpperCase()in t.logLevels?this.settings.logLevel=t.logLevels[e.toUpperCase()]:e&&e.name in t.logLevels&&(this.settings.logLevel=t.logLevels[e.name]),this.settings.logLevel?this.settings.logLevel.name:null},i.captureLogs=function(e){this.settings.captureLogs=e},i.captureLogsLimit=function(e){this.settings.captureLogsLimit=e},i.flushCapturedLogsOnLimit=function(e){this.settings.flushCapturedLogsOnLimit=e},i.flushCapturedLogsOnError=function(e){this.settings.flushCapturedLogsOnError=e},i.debug=function(e,o,s){return this.trigger(e,t.logLevels.DEBUG,o,s)},i.info=function(e,o,s){return this.trigger(e,t.logLevels.INFO,o,s)},i.warn=function(e,o,s){return this.trigger(e,t.logLevels.WARN,o,s)},i.error=function(e,o,s){return this.trigger(e,t.logLevels.ERROR,o,s)},i.trigger=function(e,o,s,n){var l;l=s||{},l.module=l.module||this.settings.module,l.date=new Date,e&&this.formatter&&!a(s)&&(e=this.formatter(e,l)),this.settings.captureLogs&&(this.settings.flushCapturedLogsOnError&&o.value>=t.logLevels.ERROR.value?this.flushCapturedLogs(this.settings.flushCapturedLogsOnError.logLevel,this.settings.flushCapturedLogsOnError.handlerTypes):(this.capturedLogs.push({message:e,level:o,data:l}),this.capturedLogs.length>=this.settings.captureLogsLimit&&(this.settings.flushCapturedLogsOnLimit?this.flushCapturedLogs(this.settings.flushCapturedLogsOnLimit.logLevel,this.settings.flushCapturedLogsOnLimit.handlerTypes):this.capturedLogs.shift()))),c.call(this,o)?this.handlers&&this.handlers.constructor===Array&&this.handlers.forEach(function(t){a(s)&&"console"==t.type||u(t,e,o,l,n)}):n&&n(!1)},i.getCapturedLogs=function(){return this.capturedLogs},i.flushCapturedLogs=function(e,o,s){var n,l=this,r=0;n=t.logLevels[e.toUpperCase()],n||(n=t.defaultFlushLogLevel),this.capturedLogs.forEach(function(e){e.level.value>=n.value&&(r++,o&&o.forEach(function(t){u(l.getHandlerByType(t),e.message,e.level,e.data)}))}),this.capturedLogs=[],s&&s(r)},i.getHandlerByType=function(e){var t;return this.handlers.some(function(o){if(o.type===e)return t=o,!0}),t},i.getHandlerTypes=function(){return this.handlers.map(function(e){return e.type})},i.addHandler=function(e){"function"==typeof e?this.handlers.push({type:"custom",write:e}):this.handlers.push(e)};var u=function(e,t,o,s,n){e&&(e.asyncWrite?e.asyncWrite(t,o,s,function(){n&&n(!0)}):(e.write(t,o,s),n&&n(!0)))},g=function(){var e=this;if(console.log){var o=console.log;console.log=function(s,n){n&&n.noCollect||e.trigger(s,t.logLevels.DEBUG,{collected:!0}),o.apply(console,arguments)}}if(console.debug){var s=console.debug;console.debug=function(o,n){n&&n.noCollect||e.trigger(o,t.logLevels.DEBUG,{collected:!0}),s.apply(console,arguments)}}if(console.info){var n=console.info;console.info=function(o,s){s&&s.noCollect||e.trigger(o,t.logLevels.INFO,{collected:!0}),n.apply(console,arguments)}}if(console.warn){var l=console.warn;console.warn=function(o,s){s&&s.noCollect||e.trigger(o,t.logLevels.WARN,{collected:!0}),l.apply(console,arguments)}}if(console.error){var r=console.error;console.error=function(o,s){s&&s.noCollect||e.trigger(o,t.logLevels.ERROR,{collected:!0}),r.apply(console,arguments)}}window.onerror=function(o,s,n,l,r){var i=["Message: "+o,"URL: "+s,"Line: "+n,"Column: "+l];r&&r.stack&&i.push("Stack: "+r.stack),i=i.join(" - "),e.trigger(i,t.logLevels.ERROR,{collected:!0})}},a=function(e){return e&&e.collected},c=function(e){var t=this.settings.logLevel;return e.value>=t.value},L=function(t){t?t.id||(t.id="logger"+o):t={id:"logger"+o};var s=new r(t);return e[s.id]=s,o++,s},h=function(t){return e[t]},f=function(e){s.push(e)};return t.logLevels={},t.logLevels.DEBUG={value:1,name:"DEBUG"},t.logLevels.INFO={value:2,name:"INFO"},t.logLevels.WARN={value:4,name:"WARN"},t.logLevels.ERROR={value:5,name:"ERROR"},t.logLevels.FATAL={value:9,name:"FATAL"},t.logLevels.OFF={value:10,name:"OFF"},t.defaultLogLevel=t.logLevels.OFF,t.defaultFlushLogLevel=t.logLevels.DEBUG,t.defaultCaptureLogsLimit=1e3,{create:L,getLoggerById:h,consts:t,addPlugin:f}});