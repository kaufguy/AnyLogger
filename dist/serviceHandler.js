!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.ServiceHandler=t()}(this,function(){var e={},t=function(t,n){var r,i={},a=[],o=0,s=n.logToService;if(s&&s.loggingUrl){var f=function(t){t.headers?t.headers instanceof Array?i.headers=t.headers:i.headers=[t.headers]:i.headers=[e.defaultServiceHeaders],void 0!=t.timeframe?(i.sendBy="timeframe",t.timeframe>e.minTimeframe?i.timeframe=t.timeframe:i.timeframe=e.minTimeframe):i.sendBy="batchSize",(t.flushOnWindowClose||void 0===t.flushOnWindowClose)&&l(),i.timeframe=60*i.timeframe*1e3,i.loggingUrl=t.loggingUrl,i.batchSize=t.batchSize||e.defaultBatchSize,i.timeout=t.timeout||e.defaultTimeout,i.requestParser=t.requestParser,"timeframe"===i.sendBy&&(r=setInterval(m,i.timeframe,!1))},u=function(e,t,n,r,o){a.push({message:n,level:r.name,module:e,scope:t,date:o}),"batchSize"===i.sendBy&&a.length>=i.batchSize&&d(a)},d=function(e){if(!(e.length<1)){var t=new XMLHttpRequest;t.open("POST",i.loggingUrl,!0),i.headers.forEach(function(e){t.setRequestHeader(Object.keys(e)[0],e[Object.keys(e)[0]])});var n;n=i.requestParser?JSON.stringify(i.requestParser(e)):JSON.stringify(e),t.send(n),a=[],o++}},m=function(){d(a)},c=function(){clearInterval(r)},l=function(){window.onbeforeunload=function(){m()}};f(s),t.addHandler({type:"service",write:function(e,t,n){u(n.module,n.scope,e,t,n.date)},flush:m,rowsCount:function(){return a.length},sentCount:function(){return o},destroy:c})}};return{create:t}});